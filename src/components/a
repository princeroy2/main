import React, { useState, useEffect } from 'react';

const Lang_Btn_list4_mbl = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [isScriptLoaded, setIsScriptLoaded] = useState(false);
  const [selectedLanguage, setSelectedLanguage] = useState('EN'); // Default language

  // List of languages (language code and name for display)
  const languageList = [
    { code: 'en', name: 'EN' },
    { code: 'ur', name: 'UR' },
    { code: 'ru', name: 'RU' },
    { code: 'es', name: 'ES' },
    { code: 'fr', name: 'FR' },
    { code: 'de', name: 'DE' },
    // Add more languages here if needed
  ];

  // Load the Google Translate script dynamically
  useEffect(() => {
    const script = document.createElement('script');
    script.src =
      'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
    script.async = true;

    // Define the callback function for when the script loads
    window.googleTranslateElementInit = () => {
      setIsScriptLoaded(true); // Set the script as loaded
      new window.google.translate.TranslateElement(
        {
          pageLanguage: 'en', // Default language of your webpage
          autoDisplay: false, // Prevent auto-displaying the widget
        },
        'google_translate_element'
      );
      const googleTranslateIcon = document.querySelector('.goog-logo-link');
      if (googleTranslateIcon) {
        googleTranslateIcon.style.display = 'none'; // Hide the icon
      }

      // Hide the Google Translate bar (or any specific element you want)
      const googleTranslateBar = document.querySelector('.goog-gt-vt');
      if (googleTranslateBar) {
        googleTranslateBar.style.display = 'none'; // Hide the translate bar
      }
    
      // After script is loaded, remove the style applied by Google Translate
      const body = document.body;
      if (body && body.style) {
        body.style.position = '';  // Remove the position style applied by Google Translate
        body.style.top = '';       // Remove the top style applied by Google Translate
      }
    };

    // Append the script to the document
    document.body.appendChild(script);

    // Cleanup script on component unmount
    return () => {
      document.body.removeChild(script);
      delete window.googleTranslateElementInit; // Clean up the global callback
    };
  }, []);

  // Function to toggle the list visibility
  const toggleList = () => {
    setIsOpen(!isOpen);
  };

  // Function to change the language dynamically
  const handleLanguageChange = (languageCode, languageText) => {
    if (isScriptLoaded && window.google && window.google.translate) {
      const selectElement = document.querySelector('.goog-te-combo');

      if (selectElement) {
        selectElement.value = languageCode; // Set the language
        selectElement.dispatchEvent(new Event('change')); // Trigger translation
        // Update selected language text and close the list
        setSelectedLanguage(languageText);
        setIsOpen(false); // Close the dropdown after selection
      } else {
        console.log('Google Translate select element not found');
      }
    } else {
      console.log('Google Translate is not available');
    }
  };

  return (
    <div className="relative w-full">
      {/* Button in the header with a plus icon */}
      <div
        onClick={toggleList}
        className="text-black flex-row px-5 cursor-pointer flex w-full justify-between items-center notranslate skiptranslate"
        style={{ zIndex: 100 }}
      >
        <span className="text-sm">{selectedLanguage}</span>
        <span className="text-sm ml-2">
            {
                isOpen?        
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="28px" fill="#666666">
                  <path d="M200-440v-80h560v80H200Z"/>
                </svg>
                :
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 -960 960 960" width="24px" fill="#666666">
                  <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/>
                </svg>
         }
        </span>
      </div>

      {/* Display fields when the list is open */}
      {isOpen && (
        <div
          className="text-[#2f3c42] w-full cursor-pointer mt-0 absolute px-2 mx-auto bg-white rounded-md shadow-lg notranslate skiptranslate"
          style={{ zIndex: 9999 }}
        >
          {/* Map through the languageList and render each language */}
          {languageList.map((lang) => (
            <div
              key={lang.code}
              className={`py-1 px-3 text-sm hover:bg-gray-200 ${selectedLanguage === lang.name ? 'bg-gray-300' : ''}`} // Highlight selected language
              onClick={() => handleLanguageChange(lang.code, lang.name)}
            >
              {lang.name}
            </div>
          ))}
        </div>
      )}

      {/* Google Translate Widget will be inserted here */}
      <div
        id="google_translate_element"
        style={{
          display: 'none', // Ensure the Google Translate widget is hidden
        }}
      >
        <iframe className="skiptranslate hidden"></iframe>
      </div>
    </div>
  );
};

export default Lang_Btn_list4_mbl;
